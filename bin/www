#!/usr/bin/env node

const { consoleInfo, consoleError } = require('../console-color')
const { PORT, NODE_ENV } = process.env

const validEnvironments = ['production', 'development', 'test']
if (!validEnvironments.includes(NODE_ENV)) {
  consoleError(`NODE_ENV not set to one of: ${validEnvironments.join(', ')}`)
  consoleError('terminating process')
  process.exit(1)
}

const server = require('../server')
const { sequelize } = require('../models')
const port = PORT || 8085

sequelize
  .sync()
  .then(() => {
    consoleInfo('db synced')
    server.listen(port, () => {
      consoleInfo(`server listening on port ${port} in ${NODE_ENV || 'development'} mode`)
    })
  })
  .catch(error => {
    consoleError('db not synced')
    consoleError(error)
  })
